---
// Importamos sanityClient (el nombre correcto para la versión actual)
import { sanityClient } from "sanity:client";

// Forzamos renderizado en el servidor para evitar el aviso de getStaticPaths
export const prerender = false;

const { slug } = Astro.params;

// Consulta a Sanity
const query = `*[_type == "caseStudy" && slug.current == $slug][0]{
  title,
  clientName,
  mainImage,
  metrics,
  body
}`;

let project;
try {
  project = await sanityClient.fetch(query, { slug });
} catch (error) {
  console.error("Error en Sanity Fetch:", error);
}

if (!project) {
  return Astro.redirect('/404');
}
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>{project.title}</title>
    <style>
      body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; line-height: 1.6; color: #333; }
      .metric { background: #f0f4f8; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 5px solid #0070f3; }
      h1 { color: #0070f3; }
    </style>
  </head>
  <body>
    <header>
      <a href="/">← Volver al Blog</a>
    </header>
    
    <h1>{project.title}</h1>
    <p><strong>Cliente:</strong> {project.clientName}</p>

    <div class="results">
      <h2>Resultados:</h2>
      {project.metrics?.map((m) => (
        <div class="metric">
          <strong>{m.label}:</strong> {m.value}
        </div>
      ))}
    </div>

    <div class="content">
      <h2>Estrategia:</h2>
      <p>{project.body}</p>
    </div>
  </body>
</html>