---
import { client, urlFor } from '../lib/sanity';
import { PortableText } from '@portabletext/react';

// Esto asegura que la página sea ultra-rápida y estable
export const prerender = true;

export async function getStaticPaths() {
  const clusters = await client.fetch(`*[_type == "cluster"]{ "slug": slug.current }`);
  return clusters.map((c: any) => ({
    params: { cluster: c.slug },
  }));
}

const { cluster: slug } = Astro.params;

const clusterData = await client.fetch(`*[_type == "cluster" && slug.current == $slug][0]{
  title,
  description,
  imagenPortada,
  contenidoDetallado
}`, { slug });

if (!clusterData) return Astro.redirect('/404');
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>{clusterData.title} | Guía SEO</title>
    <style>
      body { font-family: sans-serif; line-height: 1.6; max-width: 850px; margin: 0 auto; padding: 2rem; color: #1a1a1a; }
      .portada { width: 100%; height: auto; border-radius: 12px; margin: 2rem 0; background: #eee; }
      .intro { font-size: 1.25rem; color: #444; font-style: italic; border-left: 5px solid #007bff; padding-left: 1rem; margin-bottom: 3rem; }
      .content { font-size: 1.1rem; }
    </style>
  </head>
  <body>
    <nav><a href="/" style="text-decoration: none; color: #007bff;">← Volver al blog</a></nav>
    
    <h1>{clusterData.title}</h1>

    {clusterData.imagenPortada && (
      <img 
        src={urlFor(clusterData.imagenPortada).width(1200).url()} 
        alt={clusterData.title} 
        class="portada"
      />
    )}

    <div class="intro">{clusterData.description}</div>

    <div class="content">
      {clusterData.contenidoDetallado ? (
        <PortableText value={clusterData.contenidoDetallado} />
      ) : (
        <p>Próximamente publicaremos el contenido detallado de esta sección.</p>
      )}
    </div>
  </body>
</html>