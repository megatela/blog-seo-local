---
import { client, urlFor } from '../lib/sanity';
import { PortableText } from '@portabletext/react';

// Forzamos el renderizado estático para evitar el Error 500
export const prerender = true;

export async function getStaticPaths() {
  const clusters = await client.fetch(`*[_type == "cluster"]{ "slug": slug.current }`);
  return clusters.map((c: any) => ({
    params: { cluster: c.slug },
  }));
}

const { cluster: slug } = Astro.params;

// Consulta a Sanity con los nombres exactos de tu cluster.ts
const clusterData = await client.fetch(`*[_type == "cluster" && slug.current == $slug][0]{
  title,
  description,
  image,
  content
}`, { slug });

if (!clusterData) return Astro.redirect('/404');
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{clusterData.title} | Mi Blog SEO</title>
    <style>
      body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        line-height: 1.6; 
        max-width: 850px; 
        margin: 0 auto; 
        padding: 2rem; 
        color: #1a1a1a; 
        background-color: #fcfcfc;
      }
      nav { margin-bottom: 2rem; }
      nav a { text-decoration: none; color: #007bff; font-weight: bold; }
      h1 { font-size: 2.5rem; margin-bottom: 1rem; color: #000; }
      .portada { 
        width: 100%; 
        height: auto; 
        border-radius: 12px; 
        margin: 1.5rem 0; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      .intro { 
        font-size: 1.3rem; 
        color: #444; 
        font-style: italic; 
        border-left: 6px solid #007bff; 
        padding: 1rem 1.5rem; 
        margin: 2rem 0;
        background: #f0f7ff;
      }
      .content { 
        font-size: 1.15rem; 
        color: #333;
      }
      /* Estilos básicos para el texto de Sanity */
      .content p { margin-bottom: 1.5rem; }
      .content h2 { color: #007bff; margin-top: 2rem; }
    </style>
  </head>
  <body>
    <nav>
      <a href="/">← Volver al Inicio</a>
    </nav>
    
    <h1>{clusterData.title}</h1>

    {clusterData.image && (
      <img 
        src={urlFor(clusterData.image).width(1200).url()} 
        alt={clusterData.title} 
        class="portada"
      />
    )}

    <div class="intro">
      {clusterData.description}
    </div>

    <article class="content">
      {clusterData.content ? (
        <PortableText value={clusterData.content} />
      ) : (
        <p>El contenido detallado se está redactando. ¡Vuelve pronto!</p>
      )}
    </article>
  </body>
</html>