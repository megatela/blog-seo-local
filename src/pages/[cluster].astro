---
import { client, urlFor } from '../lib/sanity';

export async function getStaticPaths() {
  const clusters = await client.fetch(`*[_type == "cluster"]{ "slug": slug.current }`);
  return clusters.map((c: any) => ({
    params: { cluster: c.slug },
  }));
}

const { cluster: slug } = Astro.params;

const clusterData = await client.fetch(`*[_type == "cluster" && slug.current == $slug][0]{
  title,
  description,
  imagenPortada
}`, { slug });

if (!clusterData) return Astro.redirect('/404');
---

<html lang="es">
  <body>
    <h1>{clusterData.title}</h1>
    <p>{clusterData.description}</p>
    {clusterData.imagenPortada && (
      <img src={urlFor(clusterData.imagenPortada).url()} width="500" />
    )}
  </body>
</html>