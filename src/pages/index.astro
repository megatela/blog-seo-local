---
import Layout from '../layouts/Layout.astro';
import { client } from '../lib/sanity';

// 1. Fetch de los clusters existentes en Sanity
const sanityClusters = await client.fetch(`*[_type == "cluster"] | order(_createdAt asc) {
  title,
  "slug": slug.current,
  description,
  "posts": *[_type == "post" && references(^._id)][0...4] {
    title,
    "slug": slug.current
  }
}`);

// 2. Definición manual de las 3 nuevas tarjetas para completar las 9
const manualClusters = [
  {
    title: "Nichos de Alta Rentabilidad",
    slug: "nichos-rentables",
    description: "Estrategias para sectores de alta competencia local.",
    posts: [
      { title: "SEO para Cerrajeros (Emergencias)", slug: "cerrajeros" },
      { title: "Clínicas Dentales y Estéticas", slug: "clinicas" },
      { title: "Abogados y Bufetes Locales", slug: "abogados" },
      { title: "SaaS para Negocios Físicos", slug: "saas-local" }
    ]
  },
  {
    title: "Lead Magnet Geográfico",
    slug: "recursos-gratis",
    description: "Herramientas y guías descargables por ubicación.",
    posts: [
      { title: "Checklist Verificación GMB", slug: "checklist" },
      { title: "Plantilla Auditoría SEO Local", slug: "plantilla-auditoria" },
      { title: "Mapa de Competencia Local", slug: "mapa-competencia" },
      { title: "Guía de Keywords por Ciudad", slug: "keywords-ciudad" }
    ]
  },
  {
    title: "Social Proof (GMB Live)",
    slug: "recursos-autoridad",
    description: "Resultados reales y reputación verificada.",
    posts: [
      { title: "Nuestros Casos de Éxito", slug: "casos-exito" },
      { title: "Opiniones de Clientes", slug: "opiniones" },
      { title: "Cómo Gestionar Reseñas", slug: "gestion-reseñas" },
      { title: "Métricas de Crecimiento Real", slug: "metricas" }
    ]
  }
];

// Unimos todo en un solo array
const allClusters = [...sanityClusters, ...manualClusters];
---

<Layout title="Masterclass SEO Local - Domina el Mapa">
  <main class="home-container">
    <header class="hero">
      <h1>Masterclass <span class="text-gradient">SEO Local</span></h1>
      <p>La guía definitiva para dominar el algoritmo de Google Maps y captar clientes.</p>
    </header>

    <div class="grid-container">
      {allClusters.map((cluster: any) => (
        <div class="card">
          <div class="card-content">
            <h2 class="card-title">{cluster.title}</h2>
            
            <div class="pilar-section">
              <span class="label">Página Pilar</span>
              <a href={`/${cluster.slug}`} class="pilar-link">
                Guía Completa {cluster.title} →
              </a>
            </div>

            <div class="support-section">
              <span class="label">Artículos de Soporte</span>
              <ul class="support-list">
                {cluster.posts && cluster.posts.map((post: any) => (
                  <li>
                    <a href={`/${cluster.slug}/${post.slug}`}>
                      {post.title}
                    </a>
                  </li>
                ))}
                {(!cluster.posts || cluster.posts.length === 0) && (
                  <li class="coming-soon">Próximamente...</li>
                )}
              </ul>
            </div>
          </div>
        </div>
      ))}
    </div>
    
    {/* Botón de llamada a la acción al final */}
    <div style="text-align: center; margin-top: 4rem;">
       <h3 style="margin-bottom: 1.5rem;">¿Buscas resultados reales en Google Maps?</h3>
       <a href="#" class="cta-button">Solicitar Auditoría SEO</a>
    </div>
  </main>
</Layout>

<style>
  .home-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 4rem 2rem;
  }

  .hero {
    text-align: center;
    margin-bottom: 4rem;
  }

  h1 { font-size: 3.5rem; font-weight: 800; margin-bottom: 1rem; }
  .text-gradient {
    background: linear-gradient(45deg, #0070f3, #00dfd8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
  }

  .card {
    background: white;
    border: 1px solid #eaeaea;
    border-radius: 16px;
    transition: all 0.3s ease;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.1);
    border-color: #0070f3;
  }

  .card-content { padding: 2rem; }

  .card-title {
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    color: #111;
    border-left: 4px solid #0070f3;
    padding-left: 1rem;
    line-height: 1.2;
  }

  .label {
    display: block;
    font-size: 0.75rem;
    text-transform: uppercase;
    font-weight: 700;
    color: #888;
    margin-bottom: 0.5rem;
    letter-spacing: 0.05em;
  }

  .pilar-section { margin-bottom: 1.5rem; }
  .pilar-link {
    color: #0070f3;
    text-decoration: none;
    font-weight: 700;
    font-size: 1.1rem;
  }

  .support-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .support-list li {
    margin-bottom: 0.6rem;
    padding-left: 1.2rem;
    position: relative;
  }

  .support-list li::before {
    content: "•";
    position: absolute;
    left: 0;
    color: #0070f3;
    font-weight: bold;
  }

  .support-list a {
    color: #444;
    text-decoration: none;
    font-size: 0.95rem;
    transition: color 0.2s;
  }

  .support-list a:hover { color: #0070f3; }
  .coming-soon { color: #999; font-style: italic; font-size: 0.9rem; }

  .cta-button {
    background: #0070f3;
    color: white;
    padding: 1rem 2rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    box-shadow: 0 4px 14px 0 rgba(0,118,255,0.39);
    transition: background 0.2s;
  }

  .cta-button:hover {
    background: #0061d5;
  }

  @media (max-width: 768px) {
    .grid-container { grid-template-columns: 1fr; }
    h1 { font-size: 2.5rem; }
  }
</style>