---
import { client, urlFor } from '../lib/sanity';

// Consultamos todos los posts ordenados por fecha de creación
const posts = await client.fetch(`*[_type == "post"] | order(_createdAt desc){
  title,
  "slug": slug.current,
  mainImage,
  "cluster": cluster->slug.current,
  "clusterName": cluster->title
}`);
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arquitecto de SEO Local | Mi Blog Profesional</title>
    <style>
      :root { --primary: #0070f3; --text: #333; --bg: #f9f9f9; }
      body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 2rem; }
      header { text-align: center; margin-bottom: 4rem; }
      h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
      .grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
        gap: 2.5rem; 
        max-width: 1100px; 
        margin: 0 auto; 
      }
      .card { 
        background: white; 
        border-radius: 16px; 
        overflow: hidden; 
        text-decoration: none; 
        color: inherit; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
      }
      .card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
      .card img { width: 100%; height: 220px; object-fit: cover; }
      .card-body { padding: 1.5rem; }
      .tag { 
        background: #ebf5ff; 
        color: var(--primary); 
        padding: 0.3rem 0.8rem; 
        border-radius: 20px; 
        font-size: 0.75rem; 
        font-weight: 700; 
        text-transform: uppercase; 
      }
      h2 { margin: 1rem 0 0.5rem; font-size: 1.4rem; line-height: 1.3; }
      .cta { color: var(--primary); font-weight: 600; font-size: 0.9rem; }
    </style>
  </head>
  <body>
    <header>
      <h1>Arquitecto de SEO Local</h1>
      <p>Aprende a dominar el Local Pack y las búsquedas de proximidad.</p>
    </header>

    <main class="grid">
      {posts.map((post) => (
        <a href={`/${post.cluster}/${post.slug}`} class="card">
          {post.mainImage ? (
            <img src={urlFor(post.mainImage).width(500).url()} alt={post.title} />
          ) : (
            <div style="height: 220px; background: #ddd; display: grid; place-items: center;">Sin imagen</div>
          )}
          <div class="card-body">
            <span class="tag">{post.clusterName}</span>
            <h2>{post.title}</h2>
            <span class="cta">Leer guía completa →</span>
          </div>
        </a>
      ))}
    </main>
  </body>
</html>