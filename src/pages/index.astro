---
import Layout from '../layouts/Layout.astro';
import { client } from '../lib/sanity';

// 1. Recuperamos tus 2 clusters reales de Sanity
const sanityClusters = await client.fetch(`*[_type == "cluster"] | order(_createdAt asc) {
  title,
  "slug": slug.current,
  description,
  "posts": *[_type == "post" && references(^._id)][0...4] {
    title,
    "slug": slug.current
  }
}`);

// 2. Definimos las otras 7 tarjetas manualmente para completar la home
const manualClusters = [
  {
    title: "Nichos de Alta Rentabilidad",
    slug: "nichos-rentables",
    posts: [
      { title: "SEO para Cerrajeros", slug: "cerrajeros" },
      { title: "Clínicas Dentales", slug: "clinicas" },
      { title: "Abogados Locales", slug: "abogados" }
    ]
  },
  {
    title: "Lead Magnet Geográfico",
    slug: "recursos-gratis",
    posts: [{ title: "Checklist GMB 2024", slug: "checklist" }]
  },
  {
    title: "Social Proof (GMB Live)",
    slug: "reputacion",
    posts: [{ title: "Casos de Éxito", slug: "casos" }]
  },
  {
    title: "Factores de Ranking",
    slug: "factores",
    posts: [{ title: "SEO On-Page", slug: "on-page" }]
  },
  {
    title: "AI Local Search",
    slug: "ai-seo",
    posts: [{ title: "SGE Local", slug: "sge" }]
  },
  {
    title: "Herramientas",
    slug: "tools",
    posts: [{ title: "Auditoría Express", slug: "audit" }]
  },
  {
    title: "Estrategia Multi-Ubicación",
    slug: "multi-location",
    posts: [{ title: "Gestión Bulk", slug: "bulk" }]
  }
];

const allClusters = [...sanityClusters, ...manualClusters];
---

<Layout title="Masterclass SEO Local - Domina el Mapa">
  <main class="home-container">
    <header class="hero">
      <h1>Masterclass <span class="text-gradient">SEO Local</span></h1>
      <p>La guía definitiva para dominar el algoritmo de Google Maps.</p>
    </header>

    <div class="grid-container">
      {allClusters.map((cluster: any) => (
        <div class="card">
          <div class="card-content">
            <h2 class="card-title">{cluster.title}</h2>
            
            <div class="pilar-section">
              <span class="label">Página Pilar</span>
              <a href={`/${cluster.slug}`} class="pilar-link">
                Guía Completa →
              </a>
            </div>

            <div class="support-section">
              <span class="label">Artículos de Soporte</span>
              <ul class="support-list">
                {cluster.posts && cluster.posts.map((post: any) => (
                  <li>
                    <a href={`/${cluster.slug}/${post.slug}`}>
                      {post.title}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </div>
      ))}
    </div>

    <div class="cta-container">
       <h3>¿Buscas resultados reales en Google Maps?</h3>
       {/* ENLACE CORREGIDO A TU ARCHIVO contactame.astro */}
       <a href="/contactame" class="cta-button">Solicitar Auditoría SEO</a>
    </div>
  </main>
</Layout>

<style>
  .home-container { max-width: 1200px; margin: 0 auto; padding: 4rem 2rem; }
  .hero { text-align: center; margin-bottom: 4rem; }
  h1 { font-size: 3.5rem; font-weight: 800; }
  .text-gradient { background: linear-gradient(45deg, #0070f3, #00dfd8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 2rem; }
  .card { background: white; border: 1px solid #eaeaea; border-radius: 16px; transition: 0.3s; }
  .card:hover { transform: translateY(-5px); border-color: #0070f3; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
  .card-content { padding: 2rem; }
  .card-title { font-size: 1.4rem; border-left: 4px solid #0070f3; padding-left: 1rem; margin-bottom: 1.5rem; }
  .label { font-size: 0.7rem; color: #888; text-transform: uppercase; font-weight: bold; display: block; margin-bottom: 0.5rem; }
  .pilar-link { color: #0070f3; font-weight: bold; text-decoration: none; display: block; margin-bottom: 1rem; }
  .support-list { list-style: none; padding: 0; }
  .support-list li { margin-bottom: 0.5rem; font-size: 0.9rem; padding-left: 1rem; position: relative; }
  .support-list li::before { content: "•"; position: absolute; left: 0; color: #0070f3; }
  .support-list a { color: #555; text-decoration: none; }
  .cta-container { text-align: center; margin-top: 4rem; padding: 4rem; background: #f0f7ff; border-radius: 24px; }
  .cta-button { background: #0070f3; color: white; padding: 1.2rem 2.5rem; border-radius: 12px; text-decoration: none; font-weight: bold; display: inline-block; margin-top: 1rem; transition: background 0.2s; }
  .cta-button:hover { background: #0056b3; }
</style>