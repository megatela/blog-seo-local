---
import { client, urlFor } from '../../lib/sanity';
import { PortableText } from '@portabletext/react';
import Layout from '../../layouts/Layout.astro';

export const prerender = true;

export async function getStaticPaths() {
  const clusters = await client.fetch(`*[_type == "cluster"]{ "slug": slug.current }`);
  return clusters.map((c: any) => ({
    params: { cluster: c.slug },
  }));
}

const { cluster: slug } = Astro.params;

const clusterData = await client.fetch(`*[_type == "cluster" && slug.current == $slug][0]{
  title,
  description,
  image,
  content
}`, { slug });

if (!clusterData) return Astro.redirect('/404');

const components = {
  block: {
    h1: ({ children }: any) => <h2 style="font-size: 1.8rem; margin-top: 2rem;">{children}</h2>,
  },
};
---

<Layout title={clusterData.title} description={clusterData.description}>
  <main style="max-width: 850px; margin: 0 auto; padding: 2rem; font-family: system-ui, sans-serif;">
    
    <nav style="margin-bottom: 2rem; font-size: 0.9rem;">
      <a href="/" style="color: #0070f3; text-decoration: none; font-weight: bold;">← Inicio</a>
    </nav>
    
    <header style="margin-bottom: 3rem;">
      <h1 style="font-size: clamp(2.5rem, 5vw, 3.5rem); font-weight: 800; color: #111; line-height: 1.1; margin-bottom: 1.5rem;">
        {clusterData.title}
      </h1>
      
      {clusterData.image && (
        <img 
          src={urlFor(clusterData.image).width(1200).url()} 
          alt={clusterData.title} 
          style="width: 100%; height: auto; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);"
        />
      )}
    </header>

    <section style="font-size: 1.25rem; color: #444; line-height: 1.6; border-left: 5px solid #0070f3; padding: 1.5rem 2rem; margin-bottom: 3rem; background: #f8faff; border-radius: 0 12px 12px 0;">
      {clusterData.description}
    </section>

    <article style="font-size: 1.2rem; line-height: 1.8; color: #333;">
      <PortableText value={clusterData.content} components={components} />
    </article>

    <hr style="margin: 4rem 0; border: 0; border-top: 1px solid #eee;" />

    <section style="padding-bottom: 4rem;">
      <h2 style="font-size: 1.8rem; color: #111; margin-bottom: 1.5rem;">Artículos detallados</h2>
      <div style="display: grid; gap: 1rem;">
        {slug === 'google-business-profile' && (
          <a href="/google-business-profile/guia-definitiva-de-google-business-profile-domina-el-local-pack-en-2024" 
             class="card-link">
            Guía Definitiva GBP 2024 →
          </a>
        )}
      </div>
    </section>
  </main>
</Layout>

<style>
  .card-link {
    display: block; 
    padding: 25px; 
    border: 1px solid #eee; 
    border-radius: 16px; 
    text-decoration: none; 
    color: #0070f3; 
    font-weight: 700; 
    transition: all 0.2s ease;
  }
  .card-link:hover {
    border-color: #0070f3;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
  }
</style>