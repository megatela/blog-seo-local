---
import { client, urlFor } from '../../lib/sanity';
import { PortableText } from '@portabletext/react';
import Layout from '../../layouts/Layout.astro';

export const prerender = true;

export async function getStaticPaths() {
  const clusters = await client.fetch(`*[_type == "cluster"]{ "slug": slug.current }`);
  return clusters.map((c: any) => ({
    params: { cluster: c.slug },
  }));
}

const { cluster: slug } = Astro.params;

const clusterData = await client.fetch(`*[_type == "cluster" && slug.current == $slug][0]{
  title,
  description,
  image,
  content
}`, { slug });

if (!clusterData) return Astro.redirect('/404');
---

<Layout title={clusterData.title} description={clusterData.description}>
  <main style="max-width: 850px; margin: 0 auto; padding: 2rem; font-family: system-ui, sans-serif;">
    
    <nav style="margin-bottom: 2rem;">
      <a href="/" style="color: #0070f3; text-decoration: none; font-weight: bold;">← Inicio</a>
    </nav>
    
    <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">{clusterData.title}</h1>

    {clusterData.image && (
      <img 
        src={urlFor(clusterData.image).width(1200).url()} 
        alt={clusterData.title} 
        style="width: 100%; height: auto; border-radius: 12px; margin: 1.5rem 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"
      />
    )}

    <div style="font-size: 1.25rem; color: #444; font-style: italic; border-left: 6px solid #0070f3; padding: 1rem 1.5rem; margin: 2rem 0; background: #f0f7ff;">
      {clusterData.description}
    </div>

    <article style="font-size: 1.15rem; line-height: 1.7; color: #333;">
      <PortableText value={clusterData.content} />
    </article>

    <hr style="margin: 4rem 0; border: 0; border-top: 1px solid #eee;" />

    <section>
      <h2 style="color: #111;">Artículos detallados</h2>
      {slug === 'google-business-profile' && (
        <a href="/google-business-profile/guia-definitiva-de-google-business-profile-domina-el-local-pack-en-2024" style="display: block; padding: 20px; border: 1px solid #eee; border-radius: 12px; text-decoration: none; color: #0070f3; font-weight: bold; margin-top: 1rem;">
          Guía Definitiva GBP 2024 →
        </a>
      )}
    </section>
  </main>
</Layout>