---
import { client, urlFor } from '../../lib/sanity';
import { PortableText } from '@portabletext/react';
import Layout from '../../layouts/Layout.astro';

export const prerender = false;

const { cluster } = Astro.params;

const data = await client.fetch(`*[_type == "cluster" && slug.current == $cluster][0]{
  title,
  description,
  image,
  "altText": image.alt, 
  content
}`, { cluster });

if (!data) return Astro.redirect('/404');

const components = {
  block: {
    h1: 'h1',
    h2: 'h2',
    h3: 'h3',
    normal: 'p',
  }
};
---

<Layout title={data.title} description={data.description}>
  <article class="cluster-container">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <div class="nav-content">
        <a href="/">Inicio</a> 
        <span class="separator">/</span> 
        <span class="current">{data.title}</span>
      </div>
    </nav>

    <main class="main-content">
      {data.image && (
        <img 
          src={urlFor(data.image).width(1200).url()} 
          alt={data.altText || data.title} 
          class="featured-image"
          loading="eager"
        />
      )}

      <header>
        <h1 class="main-title">{data.title}</h1>
      </header>

      <div class="rich-text">
        <PortableText value={data.content} components={components} />
      </div>
    </main>
  </article>
</Layout>

<style>
  .cluster-container { background: white; min-height: 100vh; }
  
  /* Estilos de Migas de Pan */
  .breadcrumbs { 
    background: #fcfcfc; 
    padding: 0.8rem 0; 
    border-bottom: 1px solid #eee; 
    font-size: 0.85rem; 
    color: #666;
  }
  .nav-content { max-width: 800px; margin: 0 auto; padding: 0 1.5rem; }
  .breadcrumbs a { color: #0066cc; text-decoration: none; }
  .breadcrumbs a:hover { text-decoration: underline; }
  .separator { margin: 0 8px; color: #ccc; }
  .current { color: #999; font-weight: 500; }

  /* Contenido Principal */
  .main-content { max-width: 800px; margin: 0 auto; padding: 2rem 1.5rem; }
  .featured-image { 
    width: 100%; 
    aspect-ratio: 16/9; 
    object-fit: cover; 
    border-radius: 12px; 
    margin-bottom: 2rem; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.05); 
  }
  .main-title { font-size: clamp(2rem, 5vw, 2.8rem); font-weight: 800; color: #111; margin-bottom: 1.5rem; line-height: 1.2; }
  
  /* Texto Enriquecido */
  .rich-text { line-height: 1.7; font-size: 1.1rem; color: #333; }
  .rich-text :global(h2) { font-size: 1.8rem; margin-top: 2.5rem; margin-bottom: 1rem; color: #111; font-weight: 700; }
  .rich-text :global(p) { margin-bottom: 1.2rem; }
  .rich-text :global(ul) { margin-bottom: 1.2rem; padding-left: 1.5rem; }
</style>