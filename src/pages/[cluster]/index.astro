---
import { client, urlFor } from '../../lib/sanity';
import { PortableText } from '@portabletext/react';
import Layout from '../../layouts/Layout.astro';

export const prerender = false;

const { cluster } = Astro.params;

const data = await client.fetch(`*[_type == "cluster" && slug.current == $cluster][0]{
  title,
  description,
  image,
  "altText": image.alt, 
  content
}`, { cluster });

if (!data) return Astro.redirect('/404');

const components = {
  block: {
    h1: 'h1',
    h2: 'h2',
    h3: 'h3',
    normal: 'p',
  }
};
---

<Layout title={data.title} description={data.description}>
  <article class="cluster-container">
    <main class="main-content">
      {data.image && (
        <img 
          src={urlFor(data.image).width(1200).url()} 
          alt={data.altText || data.title} 
          class="featured-image"
          loading="eager"
        />
      )}

      <header>
        <h1>{data.title}</h1>
      </header>

      <div class="rich-text">
        <PortableText value={data.content} components={components} />
      </div>
    </main>
  </article>
</Layout>

<style>
  .cluster-container { background: white; min-height: 100vh; }
  .main-content { max-width: 800px; margin: 0 auto; padding: 3rem 1.5rem; }
  .featured-image { width: 100%; border-radius: 16px; margin-bottom: 2.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
  h1 { font-size: 3rem; font-weight: 800; color: #111; margin-bottom: 2rem; }
  .rich-text { line-height: 1.8; font-size: 1.15rem; color: #333; }
  .rich-text :global(h2) { font-size: 1.9rem; margin-top: 2.5rem; border-bottom: 2px solid #eee; padding-bottom: 0.5rem; }
</style>