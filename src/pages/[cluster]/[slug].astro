---
import { client, urlFor } from '../../lib/sanity';
import { PortableText } from '@portabletext/react';
import Layout from '../../layouts/Layout.astro';

export const prerender = false;
const { slug } = Astro.params;

const post = await client.fetch(`*[_type == "caseStudy" && slug.current == $slug][0]{
  title,
  metaDescription,
  "content": body
}`, { slug });

if (!post) return Astro.redirect('/404');
---

<Layout title={post.title} description={post.metaDescription}>
  <article style="max-width: 800px; margin: 50px auto; padding: 20px;">
    <h1>{post.title}</h1>
    
    <div class="content">
      {post.content ? (
        <PortableText value={post.content} />
      ) : (
        <p style="color: red; border: 1px solid red; padding: 10px;">
          Error: No hay datos en el campo 'body'. El editor en Sanity no est√° funcionando.
        </p>
      )}
    </div>
  </article>
</Layout>
