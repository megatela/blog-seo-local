---
import { client, urlFor } from '../../lib/sanity';
import { PortableText } from '@portabletext/react';
import Layout from '../../layouts/Layout.astro';

export const prerender = false;
const { slug } = Astro.params;

const post = await client.fetch(`*[_type == "caseStudy" && slug.current == $slug][0]{
  title,
  "content": coalesce(body, content),
  metaDescription
}`, { slug });

if (!post) return Astro.redirect('/404');
---

<Layout title={post.title} description={post.metaDescription}>
  <article class="max-w-3xl mx-auto py-10 px-4">
    <h1 class="text-4xl font-bold mb-10">{post.title}</h1>
    
    <div class="prose">
      {post.content ? (
        <PortableText value={post.content} />
      ) : (
        <p class="text-gray-500">Sin contenido disponible todav√≠a.</p>
      )}
    </div>
  </article>
</Layout>
