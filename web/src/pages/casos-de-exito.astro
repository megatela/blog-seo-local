---
import Layout from '../layouts/Layout.astro';
import { urlFor } from '../utils/image'; // Asegúrate de tener este helper
import { sanityClient } from "sanity:client";

const proyectos = await sanityClient.fetch(`*[_type == "caseStudy"]{
  title,
  clientName,
  mainImage,
  metrics,
  body
}`);
---

<Layout title="Casos de Éxito | Arquitecto SEO Local">
  <main>
    <h1>Mis Casos de Éxito</h1>
    {proyectos.map((proyecto) => (
      <article style="border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
        <h2>{proyecto.title}</h2>
        <p><strong>Cliente:</strong> {proyecto.clientName}</p>
        
        {proyecto.mainImage && (
          <img 
            src={urlFor(proyecto.mainImage).url()} 
            alt={proyecto.mainImage.alt} 
            style="max-width: 100%; height: auto;"
          />
        )}

        <div style="display: flex; gap: 20px; margin: 20px 0; background: #f9f9f9; padding: 10px;">
          {proyecto.metrics?.map((metrica) => (
            <div>
              <span style="display: block; font-size: 0.8rem;">{metrica.label}</span>
              <strong style="font-size: 1.5rem; color: #007bff;">{metrica.value}</strong>
            </div>
          ))}
        </div>

        <p>{proyecto.body}</p>
      </article>
    ))}
  </main>
</Layout>